# ru-banks-xlsx-parser

Позволяет парсить xlsx файлы с доходами и расходами от банков:
1. Сбербанк
2. Тинькофф
3. Точка

И класть их в базу google документ, специализированный для учета доходов и расходов и аналитики по ним
[Шаблон](https://docs.google.com/spreadsheets/d/1fExaP4qp64vZsoGyN1Fx7l8IznGkl-13AkEczeepW5c/edit?usp=sharing)

## Настройка

### Google doc

#### Service account

Чтобы иметь возможность из скрипта вставлять данные в Google document, вам нужно выполнить следующие шаги:

1. **Создание проекта в Google Cloud Console:**
   - Перейдите на [Google Cloud Console](https://console.cloud.google.com/).
   - Создайте новый проект, нажав на "Выбрать проект" (или "Select a project") в верхней части страницы и затем на "Новый проект" (или "New Project").

2. **Включение Google Sheets API для вашего проекта:**
   - В консоли управления перейдите в "Библиотека API & Services" (или "API & Services > Library").
   - Найдите "Google Sheets API" и включите его для своего проекта.

3. **Создание учетных данных:**
   - В левом меню перейдите в "Учетные данные" (или "Credentials").
   - Нажмите "Создать учетные данные" (или "Create credentials") и выберите "ID клиента OAuth" (или "OAuth client ID") если вы планируете использовать OAuth 2.0 или "Сервисный аккаунт" (или "Service account") для серверных скриптов без взаимодействия с пользователем.
   - Если вы выбрали "Сервисный аккаунт", вам потребуется предоставить некоторые детали и возможно роль для аккаунта (можно оставить поле роли пустым для простых скриптов).
   - После создания сервисного аккаунта, нажмите на созданный аккаунт, перейдите в раздел "Ключи" (или "Keys") и создайте новый ключ. Выберите JSON и скачайте файл.

4. **Делегирование доступа к вашим Google Sheets:**
   - Вернитесь к списку сервисных аккаунтов и скопируйте email сервисного аккаунта.
   - Откройте Google Sheets, к которой вы хотите получить доступ через API.
   - Раздайте доступ к этой таблице на email сервисного аккаунта, как обычно делаете это для других пользователей.

Теперь у вас есть файл учетных данных в формате JSON, который вы будете использовать для аутентификации в вашем скрипте Python.
Сохраните этот файл в директорию `creds` в проекте.

#### Spreadsheet ID

Чтобы найти идентификатор (ID) листа в Google Sheets, выполните следующие шаги:

1. Откройте нужную таблицу в Google Sheets в вашем браузере.
2. Взгляните на URL в адресной строке браузера.

   URL таблицы обычно выглядит так:
   ```
   https://docs.google.com/spreadsheets/d/1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R9S0T1U2V/edit#gid=0
   ```
   В этом URL `1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R9S0T1U2V` - это идентификатор таблицы.

3. Скопируйте часть между `/d/` и `/edit` — это и есть ID вашей Google таблицы.

Вставьте id таблицы в файл `config.py` в `SPREADSHEET_ID` или переменную окружения `SPREADSHEET_ID`.

### Файлы банков

Скачайте данные из банков в формате xlsx и положите их в соответствующую директорию банка внутри `data` в корне проекта.

> Для CберБанка нет возможности скачать единый файл для трат и зачислений, поэтому скачайте разные файлы для этих типов операций и положите их в `income` и `outcome` соответственно.

### Установка зависимостей

1. **Убедитесь, что PDM установлен.** Если PDM еще не установлен, его можно установить через pip (менеджер пакетов Python):

    ```bash
    pip install pdm
    ```

2. **Установите зависимости.** Выполните следующую команду из корня проекта, чтобы установить все зависимости, указанные в файле `pyproject.toml` вашего проекта:

    ```bash
    pdm install
    ```

PDM автоматически создаст изолированное виртуальное окружение и установит в него все зависимости проекта.

## Запуск

```bash
pdm start
```

После запуска скрипта данные из файлов банков будут загружены в Google таблицу в лист "Транзакции"
